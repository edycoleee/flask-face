<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Face - User & Photo Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='page.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üé≠ Flask Face API</h1>
            <p class="subtitle">User & Photo Management System</p>
        </header>

        <div class="main-content">
            <!-- Tabs Navigation -->
            <div class="tabs-nav">
                <button class="tab-btn active" data-tab="users">üë• Users</button>
                <button class="tab-btn" data-tab="photos">üì∏ Photos</button>
                <button class="tab-btn" data-tab="training">üß† Training</button>
                <button class="tab-btn" data-tab="prediction">üîÆ Prediction</button>
            </div>

            <!-- USERS SECTION -->
            <section id="users-tab" class="tab-content active">
                <div class="section-container">
                    <!-- Create User Form -->
                    <div class="card">
                        <h2>‚ûï Create New User</h2>
                        <form id="createUserForm" class="form">
                            <div class="form-group">
                                <label for="userName">Name</label>
                                <input type="text" id="userName" name="name" placeholder="Enter user name" required>
                            </div>
                            <div class="form-group">
                                <label for="userEmail">Email</label>
                                <input type="email" id="userEmail" name="email" placeholder="Enter user email" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Create User</button>
                        </form>
                        <div id="createUserMessage" class="message"></div>
                    </div>

                    <!-- Users List -->
                    <div class="card">
                        <h2>üìã Users List</h2>
                        <button class="btn btn-secondary" onclick="loadUsers()">üîÑ Refresh</button>
                        
                        <div id="usersContainer" class="users-list">
                            <div class="loading">Loading users...</div>
                        </div>
                    </div>

                    <!-- Edit User Modal -->
                    <div id="editUserModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeEditUserModal()">&times;</span>
                            <h2>‚úèÔ∏è Edit User</h2>
                            <form id="editUserForm" class="form">
                                <input type="hidden" id="editUserId" name="id">
                                <div class="form-group">
                                    <label for="editUserName">Name</label>
                                    <input type="text" id="editUserName" name="name" required>
                                </div>
                                <div class="form-group">
                                    <label for="editUserEmail">Email</label>
                                    <input type="email" id="editUserEmail" name="email" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Update User</button>
                            </form>
                            <div id="editUserMessage" class="message"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PHOTOS SECTION -->
            <section id="photos-tab" class="tab-content">
                <div class="section-container">
                    <!-- Select User for Photos -->
                    <div class="card">
                        <h2>üë§ Select User</h2>
                        <div class="form-group">
                            <label for="photoUserId">User</label>
                            <select id="photoUserId" onchange="onUserSelected()">
                                <option value="">-- Select User --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Upload Photos -->
                    <div class="card" id="uploadSection" style="display: none;">
                        <h2>üì§ Upload Photos</h2>
                        
                        <div class="upload-tabs">
                            <button class="upload-tab-btn active" data-upload-tab="singleUpload">Single Photo</button>
                            <button class="upload-tab-btn" data-upload-tab="multipleUpload">Multiple Photos</button>
                            <button class="upload-tab-btn" data-upload-tab="cameraUpload">üì∑ Capture from Camera</button>
                        </div>

                        <!-- Single Photo Upload -->
                        <div id="singleUploadTab" class="upload-tab-content active">
                            <form id="uploadSingleForm" class="form">
                                <div class="form-group">
                                    <label for="singlePhotoFile">Select Photo (JPG/PNG)</label>
                                    <input type="file" id="singlePhotoFile" name="file" accept="image/jpeg,image/png" required>
                                </div>
                                <div class="preview-container" id="singlePreview"></div>
                                <button type="submit" class="btn btn-primary">Upload Photo</button>
                            </form>
                            <div id="singleUploadMessage" class="message"></div>
                        </div>

                        <!-- Multiple Photos Upload -->
                        <div id="multipleUploadTab" class="upload-tab-content">
                            <form id="uploadMultipleForm" class="form">
                                <div class="form-group">
                                    <label for="multiplePhotoFiles">Select Photos (JPG/PNG)</label>
                                    <input type="file" id="multiplePhotoFiles" name="files" accept="image/jpeg,image/png" multiple required>
                                </div>
                                <div class="preview-container" id="multiplePreview"></div>
                                <button type="submit" class="btn btn-primary">Upload Photos</button>
                            </form>
                            <div id="multipleUploadMessage" class="message"></div>
                        </div>

                        <!-- Camera Capture -->
                        <div id="cameraUploadTab" class="upload-tab-content">
                            <div class="camera-container">
                                <div class="camera-controls">
                                    <button type="button" class="btn btn-secondary" id="startCameraBtn" onclick="startCamera()">üé• Start Camera</button>
                                    <button type="button" class="btn btn-secondary" id="stopCameraBtn" onclick="stopCamera()" style="display: none;">‚èπÔ∏è Stop Camera</button>
                                </div>
                                
                                <video id="cameraStream" class="camera-stream" style="display: none;"></video>
                                <canvas id="captureCanvas" style="display: none;"></canvas>
                                
                                <div id="captureContainer" style="display: none;">
                                    <button type="button" class="btn btn-primary btn-large" id="captureBtn" onclick="capturePhoto()">üì∏ Capture Photo</button>
                                </div>
                                
                                <div id="cameraPreview" class="preview-container"></div>
                                
                                <form id="uploadCameraForm" class="form" style="display: none;">
                                    <button type="submit" class="btn btn-primary">Upload Captured Photo</button>
                                </form>
                                <div id="cameraUploadMessage" class="message"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Photos Gallery -->
                    <div class="card" id="photosSection" style="display: none;">
                        <h2>üñºÔ∏è User Photos Gallery</h2>
                        <button class="btn btn-secondary" onclick="loadUserPhotos()">üîÑ Refresh</button>
                        
                        <div id="photosContainer" class="photos-gallery">
                            <div class="loading">No user selected</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TRAINING SECTION -->
            <section id="training-tab" class="tab-content">
                <div class="section-container">
                    <!-- Training Configuration -->
                    <div class="card">
                        <h2>üß† CNN Model Training</h2>
                        <p class="card-description">Train face recognition model with your dataset</p>
                        
                        <form id="trainingForm" class="form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="trainingMode">Training Mode</label>
                                    <select id="trainingMode" name="continue_training">
                                        <option value="false">üÜï New Training (Reset Model)</option>
                                        <option value="true">üîÑ Continue Training (Lanjut)</option>
                                    </select>
                                    <small class="form-help">Reset akan membuat model baru, Continue akan lanjut dari model yang ada</small>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="epochs">Epochs</label>
                                    <input type="number" id="epochs" name="epochs" value="50" min="10" max="200" required>
                                    <small class="form-help">Jumlah iterasi training (default: 50)</small>
                                </div>

                                <div class="form-group">
                                    <label for="batchSize">Batch Size</label>
                                    <input type="number" id="batchSize" name="batch_size" value="16" min="4" max="64" required>
                                    <small class="form-help">Ukuran batch per iterasi (default: 16)</small>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="validationSplit">Validation Split</label>
                                    <input type="number" id="validationSplit" name="validation_split" value="0.2" min="0.1" max="0.4" step="0.05" required>
                                    <small class="form-help">Rasio data validasi (0.2 = 20%)</small>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary btn-large" id="startTrainingBtn">
                                    üöÄ Start Training
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="checkModelStatus()">
                                    üìä Check Model Status
                                </button>
                            </div>
                        </form>
                        <div id="trainingMessage" class="message"></div>
                    </div>

                    <!-- Training Progress -->
                    <div class="card" id="trainingProgressCard" style="display: none;">
                        <h2>‚è≥ Training Progress</h2>
                        <div id="trainingProgress" class="training-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                            </div>
                            <p class="progress-text" id="progressText">Initializing...</p>
                        </div>
                    </div>

                    <!-- Training Results -->
                    <div class="card" id="trainingResultsCard" style="display: none;">
                        <h2>üìà Training Results</h2>
                        <div id="trainingResults" class="training-results">
                            <!-- Results will be populated here -->
                        </div>
                    </div>

                    <!-- Model Status -->
                    <div class="card">
                        <h2>üîç Current Model Status</h2>
                        <button class="btn btn-secondary" onclick="checkModelStatus()">üîÑ Refresh Status</button>
                        <div id="modelStatus" class="model-status">
                            <div class="loading">Loading model status...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PREDICTION SECTION -->
            <section id="prediction-tab" class="tab-content">
                <div class="section-container">
                    <!-- Model Status Check -->
                    <div class="card">
                        <h2>ü§ñ Model Status</h2>
                        <button class="btn btn-secondary" onclick="checkPredictionModelStatus()">üîÑ Refresh Status</button>
                        <div id="predictionModelStatus" class="model-status">
                            <div class="loading">Loading model status...</div>
                        </div>
                    </div>

                    <!-- Prediction Input -->
                    <div class="card">
                        <h2>üîÆ Face Recognition Prediction</h2>
                        <p class="card-description">Upload atau capture foto untuk identifikasi wajah</p>
                        
                        <div class="upload-tabs">
                            <button class="upload-tab-btn active" data-upload-tab="predictUpload">üì§ Upload Photo</button>
                            <button class="upload-tab-btn" data-upload-tab="predictCamera">üì∑ Capture from Camera</button>
                        </div>

                        <!-- Upload Photo for Prediction -->
                        <div id="predictUploadTab" class="upload-tab-content active">
                            <form id="predictUploadForm" class="form">
                                <div class="form-group">
                                    <label for="predictPhotoFile">Select Photo (JPG/PNG)</label>
                                    <input type="file" id="predictPhotoFile" name="file" accept="image/jpeg,image/png" required>
                                </div>
                                <div class="preview-container" id="predictUploadPreview"></div>
                                <button type="submit" class="btn btn-primary btn-large">üîç Predict Face</button>
                            </form>
                            <div id="predictUploadMessage" class="message"></div>
                        </div>

                        <!-- Camera Capture for Prediction -->
                        <div id="predictCameraTab" class="upload-tab-content">
                            <div class="camera-container">
                                <div class="camera-controls">
                                    <button type="button" class="btn btn-secondary" id="startPredictCameraBtn" onclick="startPredictCamera()">üé• Start Camera</button>
                                    <button type="button" class="btn btn-secondary" id="stopPredictCameraBtn" onclick="stopPredictCamera()" style="display: none;">‚èπÔ∏è Stop Camera</button>
                                </div>
                                
                                <video id="predictCameraStream" class="camera-stream" style="display: none;"></video>
                                <canvas id="predictCaptureCanvas" style="display: none;"></canvas>
                                
                                <div id="predictCaptureContainer" style="display: none;">
                                    <button type="button" class="btn btn-primary btn-large" id="predictCaptureBtn" onclick="capturePredictPhoto()">üì∏ Capture Photo</button>
                                </div>
                                
                                <div id="predictCameraPreview" class="preview-container"></div>
                                
                                <form id="predictCameraForm" class="form" style="display: none;">
                                    <button type="submit" class="btn btn-primary btn-large">üîç Predict Face</button>
                                </form>
                                <div id="predictCameraMessage" class="message"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Prediction Results -->
                    <div class="card" id="predictionResultsCard" style="display: none;">
                        <h2>üìä Prediction Results</h2>
                        <div id="predictionResults" class="prediction-results">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Flask Face API v1.0 | Built with ‚ù§Ô∏è</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='page.js') }}"></script>
</body>
</html>
